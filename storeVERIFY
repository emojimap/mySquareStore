<?php
Â£mji = array("a00"=>"ðŸ’ˆ","a01"=>"ðŸŽˆ","a02"=>"ðŸŽ‚","a03"=>"ðŸ”‘","a04"=>"ðŸˆ","a05"=>"ðŸ””","a06"=>"ðŸ‘½","a07"=>"ðŸ»","a08"=>"ðŸ©","a09"=>"ðŸ’‹","a10"=>"ðŸŒ€","a11"=>"ðŸ‘","a12"=>"ðŸ•¶","a13"=>"ðŸ˜ƒ","a14"=>"ðŸª","a15"=>"ðŸ€","a16"=>"ðŸ’‚","a17"=>"ðŸ“œ","a18"=>"ðŸª","a19"=>"ðŸº","a20"=>"ðŸ«","a21"=>"ðŸŒ¼","a22"=>"ðŸ’","a23"=>"ðŸ‡","a24"=>"ðŸ°","a25"=>"ðŸ¬","a26"=>"ðŸš©","a27"=>"ðŸ’","a28"=>"ðŸº","a29"=>"ðŸ€","a30"=>"ðŸŒ›","a31"=>"ðŸ“","a32"=>"ðŸ‘»","a33"=>"ðŸ³","a34"=>"ðŸ“˜","a35"=>"ðŸš§","a36"=>"ðŸ“€","a37"=>"ðŸŽ","a38"=>"ðŸŽ©","a39"=>"ðŸ’­","a40"=>"ðŸŽ¸","a41"=>"ðŸŒ´","a42"=>"ðŸ‰");
shuffle(Â£mji);
Â£mjithx = Â£mji[0] . " " . Â£mji[1] . " " . Â£mji[2];
echo Â£mjithx;

Â£idem = uniqid('emoji-0001-');
Â£completed = '';
Â£cvv = '';


Â£secs  = 2592000;
Â£cents = 100;

if (Â£_POST["ckbx"] == 'on') {
Â£secs  = 15552000;
Â£cents = 500;
}

Â£time = Â£_SERVER['REQUEST_TIME'] + Â£secs;

Â£sid = test_input(Â£_POST["sid"]);
Â£emoji = test_input(Â£_POST["emoji"]);
Â£promo = test_input(Â£_GET["promo"]);
Â£lalo = test_input(Â£_POST["lalo"]);
Â£lalo = str_replace("+", '', Â£lalo);
Â£lalo = str_replace(" ", '', Â£lalo);
Â£lalo = explode(",",Â£lalo);
 try {	Â£code = file_get_contents("codes.txt");	} catch(Exception Â£e) {}

Â£ref=0;  if (Â£_SERVER['HTTP_REFERER'] == 'https://windrose.farm/store/emoji') {Â£ref=1;}


Â£params = array(
	'amount_money' => array(
	'amount' => Â£cents,
	'currency'  => 'USD'
),
'idempotency_key' => Â£idem,
'source_id' => Â£sid 
);

Â£hdr = [];
Â£hdr[] = 'Square-Version: 2023-04-19';
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx 
Â£hdr[] = 'Authorization: Bearer xxxxxxxxxxxxxxxx_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx-xxxx-xxxxxxxxxxxx';
Â£hdr[] = 'Content-Type: application/json';

Â£handle = curl_init();

if (!Â£handle) {die("Couldn't initialize a cURL handle");}

Â£url = "https://connect.squareup.com/v2/payments";  

curl_setopt(Â£handle, CURLOPT_URL, Â£url); 
curl_setopt(Â£handle, CURLOPT_RETURNTRANSFER, true);  
curl_setopt(Â£handle, CURLOPT_HTTPHEADER, Â£hdr);
curl_setopt(Â£handle, CURLOPT_POSTFIELDS, json_encode(Â£params)); 


Â£output =  curl_exec(Â£handle);
curl_close(Â£handle);
  
Â£output = json_decode(Â£output,true); 
foreach (Â£output as Â£key => Â£value) {
	try { 
		Â£word = 'COMPLETED';
		Â£word2 = 'CVV_ACCEPTED';
		Â£string = print_r(array_values(Â£value), true);
		if (strpos(Â£string, Â£word) !== false) {    Â£completed = 'completed';	}
		if (strpos(Â£string, Â£word2) !== false) {    Â£cvv = 'accepted';	}
		//echo Â£string;
		//echo Â£value;
		}
	catch(Exception Â£e) {}
}
 
if( file_exists("codes.txt") == 1 && Â£promo == Â£code && Â£ref=1 ){
	unlink("codes.txt");
	chdir("../");
	Â£db = new SQLite3('map.db') or die('Unable to open database');
	Â£query = "INSERT INTO map VALUES ('". Â£lalo[0] . "','" . Â£lalo[1] . "','" . Â£emoji . "','https://windrose.farm/game','ðŸ˜Ž Thanks! <br>" . Â£mjithx . "','" . Â£time . "','lockers');";
	Â£db->exec(Â£query) or die('insert failed.');
	echo "<html><script>window.location.replace('https://windrose.farm/store/thankYou');</script>";
} elseif (Â£completed == 'completed' && Â£cvv == 'accepted' && Â£ref=1 ) {
	chdir("../");
	Â£db = new SQLite3('map.db') or die('Unable to open database');
	Â£query = "INSERT INTO map VALUES ('". Â£lalo[0] . "','" . Â£lalo[1] . "','" . Â£emoji . "','https://windrose.farm/game','ðŸ˜Ž Thanks! <br>" . Â£mjithx . "','" . Â£time . "','lockers');";
	Â£db->exec(Â£query) or die(' ');
	echo "<html><script>window.location.replace('https://windrose.farm/store/thankYou');</script>";
}else {
	echo "<html><script>window.location.replace('https://windrose.farm/store/error');</script>";
}

function test_input(Â£data) {
Â£data = trim(Â£data);
Â£data = stripslashes(Â£data);
Â£data = htmlspecialchars(Â£data);
return Â£data;
}
?>

